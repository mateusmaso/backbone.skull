// hipbone
// ------------------
// v1.0.0
//
// Copyright (c) 2012-2015 Mateus Maso
// Distributed under MIT license
//
// http://github.com/mateusmaso/hipbone

(function(){window.Hipbone={VERSION:"1.0.0"}}).call(this),function(){var a=[].slice;Hipbone.Ajax={initializeAjax:function(a,b){return this.host||(this.host=a||""),this.headers||(this.headers=b||{})},ajax:function(a){return null==a&&(a={}),this.ajaxHandle($.ajax(this.ajaxSettings(a)))},ajaxHandle:function(b){return b.done(function(b){return function(){return b.trigger.apply(b,["ajaxSuccess"].concat(a.call(arguments)))}}(this)),b.fail(function(b){return function(){return b.trigger.apply(b,["ajaxError"].concat(a.call(arguments)))}}(this)),b},ajaxSettings:function(a){var b,c,d;null==a&&(a={}),a.url=this.host+a.url,"POST"===a.type&&(a.dataType="json",a.contentType="application/json",a.data=JSON.stringify(a.data)),a.headers||(a.headers={}),c=this.headers;for(b in c)d=c[b],_.isFunction(d)&&(d=d.apply(this)),a.headers[b]=d;return a.beforeSend=_.catenate(function(a,b){return null==b&&(b={}),a.settings=b},a.beforeSend),a}}}.call(this),function(){var a,b,c,d,e=[].slice,f=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};for(Hipbone.Module=function(){function a(){}var b;return b=["included","extended"],a.include=function(){var a,c,d,g,h,i,j;for(h=1<=arguments.length?e.call(arguments,0):[],j=[],a=0,c=h.length;c>a;a++){g=h[a];for(i in g)d=g[i],f.call(b,i)<0&&(this.prototype[i]=d);g.included?j.push(g.included.apply(this)):j.push(void 0)}return j},a.extend=function(){var a,c,d,g,h,i,j;for(h=1<=arguments.length?e.call(arguments,0):[],j=[],a=0,c=h.length;c>a;a++){g=h[a];for(i in g)d=g[i],f.call(b,i)<0&&(this[i]=d);g.extended?j.push(g.extended.apply(this)):j.push(void 0)}return j},a}(),d=["Model","Collection","Router","View","History"],a=0,b=d.length;b>a;a++)c=d[a],Backbone[c]=_.extend(Backbone[c],Hipbone.Module),Backbone[c].prototype=_.extend(Backbone[c].prototype,Hipbone.Module.prototype)}.call(this),function(){Hipbone.Mapping={initializeMapping:function(a,b){return null==a&&(a={}),null==b&&(b=[]),this.transients={},this.mappings=_.extend({},this.mappings,a),this.polymorphics=_.union([],this.polymorphics,b)},mappingIdAttribute:function(a){return a+"_id"},mappingTypeAttribute:function(a){return a+"_type"},getMapping:function(a){var b,c,d,e,f;return f=this.mappings[a],Hipbone.app.models[f]||_.contains(this.polymorphics,a)?(d=this.get(this.mappingIdAttribute(a)),f=this.get(this.mappingTypeAttribute(a))||f,b={},b[Hipbone.app.models[f].prototype.idAttribute]=d,d&&(e=new Hipbone.app.models[f](b))):Hipbone.app.collections[f]&&(c=new Hipbone.app.collections[f]({parent:this})),e||c||this.transients[a]},setMapping:function(a,b,c){var d,e,f,g,h;return null==c&&(c={}),h=this.mappings[a],b instanceof Hipbone.Model?f=b:b instanceof Hipbone.Collection?(d=b,d.setParent(this)):Hipbone.app.models[h]||_.contains(this.polymorphics,a)?(h=this.parseMappingType(a,b)||h,b&&(f=new Hipbone.app.models[h](b,c))):Hipbone.app.collections[h]&&(_.isArray(b)?g=b:_.isObject(b)&&(e=b.meta,g=b.models),d=new Hipbone.app.collections[h](g,_.extend(c,{parent:this,meta:e}))),f?(this.set(this.mappingIdAttribute(a),f.id),_.contains(this.polymorphics,a)&&this.set(this.mappingTypeAttribute(a),f.type),f.isNew()&&(this.transients[a]=f)):d?this.transients[a]=d:(delete this.transients[a],this.unset(this.mappingIdAttribute(a)),this.unset(this.mappingTypeAttribute(a))),f||d},parseMappingType:function(a,b){return null==b&&(b={}),b.type},toJSONMappings:function(a){var b,c,d,e;b={};for(c in a)d=a[c],b[c]=null!=(e=this.getMapping(c))?e.toJSON(d):void 0;return b}}}.call(this),function(){Hipbone.Accessor={initializeAccessor:function(a){var b,c,d,e,f,g;return null==a&&(a={}),this.defaults||(this.defaults={}),this.accessorName||(this.accessorName=a.accessorName||""),this.accessorsName||(this.accessorsName=a.accessorsName||""),this.accessorEvent||(this.accessorEvent=a.accessorEvent||"change"),this.accessors=this[this.accessorsName]={},this.setAccessor(_.defaults({},a.accessors,this.defaults,a.defaults),{silent:!0}),b=this.accessorName?_.string.capitalize(this.accessorName):"",this[c="get"+b]||(this[c]=this.getAccessor),this[d="set"+b]||(this[d]=this.setAccessor),this[e="unset"+b]||(this[e]=this.unsetAccessor),this[f="changed"+b]||(this[f]=this.changedAccessors),this[g="previous"+b]||(this[g]=this.previousAccessor)},getAccessor:function(a){return _.path(this.accessors,a)},setAccessor:function(a,b,c){var d,e,f,g,h,i,j;if(null==c&&(c={}),_.isObject(a)?(d=a,c=b||{}):(d={},d[a]=b),this._previousAccessors=_.clone(this.accessors),this._changedAccessors=this.changedAccessors(d),!_.isEmpty(this._changedAccessors)){if(this.accessors=_.pathExtend(this.accessors,this._changedAccessors),!c.silent){i=this._changedAccessors;for(a in i)for(b=i[a],h=a.split("."),j=_.clone(h).reverse(),e=0,f=j.length;f>e;e++)g=j[e],a=h.join("."),h.pop(),this.trigger(this.accessorEvent+":"+a,this,_.path(this._previousAccessors,a),c);this.trigger(this.accessorEvent,this,d,c)}return delete this._previousAccessors}},unsetAccessor:function(a,b){return null==b&&(b={}),this.setAccessor(a,void 0,b)},previousAccessor:function(a){return this._previousAccessors?this._previousAccessors[a]:void 0},changedAccessors:function(a){var b,c,d;c={};for(b in a)d=a[b],_.isEqual(this.getAccessor(b),d)||(c[b]=d);return c}}}.call(this),function(){Hipbone.Validation={initializeValidation:function(a){return null==a&&(a={}),this.errors=[],this.validations=_.extend({},this.validations,a)},hasErrors:function(a){return null==a&&(a=[]),_.isEmpty(a)?this.errors.length>0:_.intersection(this.errors,a).length>0},validate:function(a){var b,c,d;null==a&&(a={}),this.errors=[];for(b in a)d=a[b],c=this.validations[b],c&&!c.apply(this,[d,a])&&this.errors.push(b);return this.hasErrors()?this.errors:void 0}}}.call(this),function(){Hipbone.ComputedAttribute={initializeComputedAttribute:function(a){return null==a&&(a={}),this.computedAttributes||(this.computedAttributes={})},getComputedAttribute:function(a){var b;return b=this.computedAttributes[a],_.isFunction(b)||(b=this[b]),b?b.apply(this):void 0},setComputedAttribute:function(a,b){var c;return c=this.computedAttributes[a],_.isFunction(c)||(c=this[c]),c?c.apply(this,[b]):void 0},toJSONComputedAttributes:function(a){var b,c,d,e;for(d={},c=0,e=a.length;e>c;c++)b=a[c],d[b]=this.getComputedAttribute(b);return d}}}.call(this),function(){var a=function(a,c){function d(){this.constructor=a}for(var e in c)b.call(c,e)&&(a[e]=c[e]);return d.prototype=c.prototype,a.prototype=new d,a.__super__=c.prototype,a},b={}.hasOwnProperty;Hipbone.Model=function(b){function c(a,b){var d,e;return null==a&&(a={}),null==b&&(b={}),d=this.hashes(a),(e=Hipbone.app.identityMap.findAll(d)[0])?(e.set(a,b),e):(this.store(d),this.initializeMapping(),this.initializeValidation(),this.initializeComputedAttribute(),void c.__super__.constructor.apply(this,arguments))}return a(c,b),c.include(Hipbone.Mapping),c.include(Hipbone.Validation),c.include(Hipbone.ComputedAttribute),c.prototype.hashName="model",c.prototype.typeAttribute="type",c.prototype.get=function(a){return this.mappings[a]||_.contains(this.polymorphics,a)?this.getMapping(a):this.computedAttributes[a]?this.getComputedAttribute(a):_.path(this.attributes,a)},c.prototype.set=function(a,b,d){var e,f,g,h,i,j,k,l,m,n,o;null==d&&(d={}),_.isObject(a)?(e=a,d=b||{}):(e={},e[a]=b),this.type=e[this.typeAttribute]||this.type,n=_.pick(e,_.keys(this.mappings),this.polymorphics);for(a in n)b=n[a],this.setMapping(a,b,{parse:!0}),delete e[a];f=!1,j=function(a){return function(){return f=!1}}(this);for(a in e)if(b=e[a],l=a.split("."),l.length>1&&(b=e[a],delete e[a],!_.isEqual(this.get(a),b)&&(i={},i[a]=b,m=this.get(a),this.attributes=_.pathExtend(this.attributes,i),!d.silent)))for(o=_.clone(l).reverse(),g=0,h=o.length;h>g;g++)k=o[g],a=l.join("."),l.pop(),f=!0,this.trigger("change:"+a,this,m,d);return this.on("change",j),c.__super__.set.call(this,e,d),this.off("change",j),f&&this.trigger("change",this,d),this.store()},c.prototype.toJSON=function(a){var b,d,e,f,g;null==a&&(a={}),g=a.mappings||{};for(e in g)f=g[e],f.sync=a.sync;return b=a.computedAttributes||_.keys(this.computedAttributes),d=_.deepClone(c.__super__.toJSON.apply(this,arguments)),a.sync||(d=_.extend(d,{cid:this.cid},this.toJSONComputedAttributes(b),this.toJSONMappings(g))),d},c.prototype.hashes=function(a){var b;return b=[],this.cid&&b.push(this.cid),a[this.idAttribute]&&b.push(this.hashName+"-"+a[this.idAttribute]),b},c.prototype.parse=function(a){return null==a&&(a={}),this.synced=Date.now(),a},c.prototype.prepare=function(){return $.when(this.synced||this.fetch())},c.prototype.unsync=function(){return delete this.synced,this.trigger("unsync",this)},c.prototype.store=function(a){return a||(a=this.hashes(this.attributes)),Hipbone.app.identityMap.storeAll(a,this)},c}(Backbone.Model)}.call(this),function(){var a=function(a,c){function d(){this.constructor=a}for(var e in c)b.call(c,e)&&(a[e]=c[e]);return d.prototype=c.prototype,a.prototype=new d,a.__super__=c.prototype,a},b={}.hasOwnProperty;Hipbone.Application=function(b){function c(a){var b,c,d,e;for(null==a&&(a={}),Hipbone.app=this,this.views||(this.views=a.views||{}),this.title||(this.title=a.title||"App"),this.locale||(this.locale=a.local||"en"),this.models||(this.models=a.models||{}),this.assets||(this.assets=a.assets||{}),this.routes||(this.routes=a.routes||{}),this.matches||(this.matches=a.matches||[]),this.templates||(this.templates=a.templates||{}),this.collections||(this.collections=a.collections||{}),this.templatePath||(this.templatePath=a.templatePath||""),a.locales&&(this.locales=a.locales),a.initializers&&(this.initializers=a.initializers),this.i18n=new Hipbone.I18n(this.locales[this.locale]),this.router=new Hipbone.Router({matches:this.matches}),this.storage=new Hipbone.Storage,this.identityMap=new Hipbone.IdentityMap,this.initializeAccessor({accessorsName:"attributes",accessors:a.attributes}),this.initializeAjax(a.host,a.headers),this.initialize(a),e=this.initializers,b=0,d=e.length;d>b;b++)c=e[b],c.apply(this,[a])}return a(c,b),c.include(Hipbone.Ajax),c.include(Hipbone.Accessor),c.include(Backbone.Events),c.prototype.locales={},c.prototype.initializers=[],c.prototype.initialize=function(){},c.prototype.run=function(){return this.trigger("run")},c}(Hipbone.Module)}.call(this),function(){var a=function(a,c){function d(){this.constructor=a}for(var e in c)b.call(c,e)&&(a[e]=c[e]);return d.prototype=c.prototype,a.prototype=new d,a.__super__=c.prototype,a},b={}.hasOwnProperty;Hipbone.Collection=function(b){function c(a,b){var d,e;return null==b&&(b={}),_.isArray(a)||(b=a||{},a=void 0),e=this.hashes(a,b),(d=Hipbone.app.identityMap.findAll(e)[0])?(a&&d.set(a,b),b.meta&&d.setMeta(b.meta),b.parent&&(d.parent=b.parent),d):(this.store(e),this.cid=_.uniqueId("col"),this.parent=b.parent,this.initializeAccessor({accessorName:"meta",accessorsName:"meta",accessorEvent:"change:meta",accessors:b.meta,defaults:{offset:0,limit:10}}),void c.__super__.constructor.apply(this,arguments))}return a(c,b),c.include(Hipbone.Accessor),c.prototype.model=Hipbone.Model,c.prototype.hashName="collection",c.prototype._prepareModel=function(a,b){return null==b&&(b={}),this._isModel(a)||(a=new(Hipbone.app.models[this.parseModelType(a)]||this.model)(a,b)),c.__super__._prepareModel.apply(this,arguments)},c.prototype.modelId=function(a){var b;return b=this.model&&this._isModel(this.model.prototype)?this.model:Hipbone.app.models[this.parseModelType(a)],a[b.prototype.idAttribute]?a[b.prototype.typeAttribute]+"-"+a[b.prototype.idAttribute]:c.__super__.modelId.apply(this,arguments)},c.prototype.url=function(){return this.parent?this.parent.url()+this.urlRoot:this.urlRoot},c.prototype.set=function(a,b){return null==b&&(b={}),c.__super__.set.call(this,a,b),this.store()},c.prototype.setAccessor=function(){return Hipbone.Accessor.setAccessor.apply(this,arguments),this.store()},c.prototype.fetch=function(a){var b,d,e;null==a&&(a={}),a.data||(a.data={}),d=this.meta;for(b in d)e=d[b],null!=e&&(a.data[b]=e);return a.increment?(this.setMeta({offset:this.getMeta("offset")+this.getMeta("limit")}),a.data.offset=this.getMeta("offset")):(a.data.offset=0,a.data.limit=this.getMeta("offset")+this.getMeta("limit")),c.__super__.fetch.call(this,a)},c.prototype.fetchMore=function(a){return null==a&&(a={}),this.fetch(_.extend({remove:!1,increment:!0},a))},c.prototype.hasMore=function(){return this.length===this.getMeta("offset")+this.getMeta("limit")},c.prototype.toJSON=function(a){var b;return null==a&&(a={}),b=c.__super__.toJSON.apply(this,arguments),a.sync||(b=_.extend(_.deepClone(this.meta),{length:this.length,cid:this.cid,models:b})),b},c.prototype.hashes=function(a,b){var c,d;return null==b&&(b={}),c=[],this.cid&&c.push(this.cid),(null!=(d=b.parent)?d.cid:void 0)&&c.push(this.hashName+"-"+b.parent.cid),c},c.prototype.parse=function(a){return null==a&&(a={}),this.synced=Date.now(),this.setMeta(a.meta),a.models||a},c.prototype.parseModelType=function(a){return null==a&&(a={}),a.type},c.prototype.prepare=function(){return $.when(this.synced||this.fetch())},c.prototype.unsync=function(){return delete this.synced,this.trigger("unsync",this)},c.prototype.store=function(a){return a||(a=this.hashes(this.models,{parent:this.parent,meta:this.meta})),Hipbone.app.identityMap.storeAll(a,this)},c}(Backbone.Collection)}.call(this),function(){var a=function(a,c){function d(){this.constructor=a}for(var e in c)b.call(c,e)&&(a[e]=c[e]);return d.prototype=c.prototype,a.prototype=new d,a.__super__=c.prototype,a},b={}.hasOwnProperty;Hipbone.History=function(b){function c(){return c.__super__.constructor.apply(this,arguments)}return a(c,b),c.prototype.route=function(a,b){return this.handlers.push({route:a,callback:b})},c.prototype.reload=function(a){return a?this.location.assign(a):this.location.reload()},c.prototype.change=function(a){var b,c,d;for(c in a)d=a[c],null==d&&delete a[c];return b=this.location.pathname,_.isEmpty(a)||(b+="?"+$.param(a)),this.history.replaceState({},document.title,b)},c.prototype.parameters=function(){var a,b,c,d,e,f;for(d={},e=/([^&=]+)=?([^&]*)/g;b=e.exec(this.location.search.substring(1));)c=b[0],a=b[1],f=b[2],d[this.decode(a)]=_.parse(this.decode(f));return d},c.prototype.decode=function(a){return decodeURIComponent(a.replace(/\+/g," "))},c.prototype.checkUrl=function(a){return this.popstate=!0,c.__super__.checkUrl.apply(this,arguments),this.popstate=!1},c}(Backbone.History),Hipbone.history=Backbone.history=new Hipbone.History}.call(this),function(){var a=function(a,c){function d(){this.constructor=a}for(var e in c)b.call(c,e)&&(a[e]=c[e]);return d.prototype=c.prototype,a.prototype=new d,a.__super__=c.prototype,a},b={}.hasOwnProperty;Hipbone.I18n=function(b){function c(a,b){this.locale=a,this.splitter=b||/{{\w+}}/g}return a(c,b),c.prototype.interpolate=function(a,b){var c,d,e,f,g;for(null==b&&(b={}),f=a.match(this.splitter)||[],c=0,d=f.length;d>c;c++)e=f[c],g=b[e.replace(/\W/g,"")],a=a.replace(e,g);return a},c.prototype.pluralize=function(a,b){return a+=0===b?".zero":1===b?".one":".other",_.path(this.locale,a)},c.prototype.inflector=function(a,b){return a+="m"===b?".male":"f"===b?".female":".neutral",_.path(this.locale,a)},c.prototype.translate=function(a,b){var c;return null==b&&(b={}),c=_.has(b,"count")?this.pluralize(a,b.count):_.has(b,"gender")?this.inflector(a,b.gender):_.path(this.locale,a),this.interpolate(c,b)},c.prototype.t=c.prototype.translate,c}(Hipbone.Module)}.call(this),function(){var a=function(a,c){function d(){this.constructor=a}for(var e in c)b.call(c,e)&&(a[e]=c[e]);return d.prototype=c.prototype,a.prototype=new d,a.__super__=c.prototype,a},b={}.hasOwnProperty;Hipbone.IdentityMap=function(b){function c(){this.instances={}}return a(c,b),c.prototype.match=function(a){var b,c,d,e;d={},e=this.instances;for(c in e)b=e[c],a.test(c)&&(d[c]=b.value);return d},c.prototype.find=function(a){var b,c;return(c=null!=(b=this.instances[a])?b.value:void 0)&&this.store(a,c),c},c.prototype.findAll=function(a){var b,c,d,e,f;for(f=[],b=0,d=a.length;d>b;b++)c=a[b],(e=this.find(c))&&f.push(e);return f},c.prototype.store=function(a,b,c){var d;return null==c&&(c={}),d={value:b},this.instances[a]=_.extend(d,c)},c.prototype.storeAll=function(a,b,c){var d,e,f,g;for(null==c&&(c={}),g=[],d=0,f=a.length;f>d;d++)e=a[d],g.push(this.store(e,b,c));return g},c.prototype["delete"]=function(a){return delete this.instances[a]},c.prototype.deleteAll=function(a){var b,c,d,e;for(e=[],b=0,d=a.length;d>b;b++)c=a[b],e.push(this["delete"](c));return e},c}(Hipbone.Module)}.call(this),function(){Hipbone.Application.prototype.initializers.push(function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r;q=function(a,b,c){return null==a.prototype[b]||_.isEqual(a.__super__[b],a.prototype[b])?a.prototype[b]=c:void 0},i=_.pick(this.constructor,_.functions(this.constructor));for(h in i)g=i[h],g.prototype instanceof Hipbone.View&&(this.views[h]=g),g.prototype instanceof Hipbone.Model&&(this.models[h]=g),g.prototype instanceof Hipbone.Route&&(this.routes[h]=g),g.prototype instanceof Hipbone.Collection&&(this.collections[h]=g);j=this.routes;for(h in j)c=j[h],q(c,"hashName",_.string.dasherize(h).substring(1));k=this.views;for(h in k)d=k[h],q(d,"hashName",_.string.dasherize(h).substring(1));l=this.models;for(h in l)b=l[h],b.prototype.defaults=_.extend({},_.clone(b.prototype.defaults),{type:h}),q(b,"hashName",_.string.dasherize(h).substring(1));m=this.collections;for(h in m)a=m[h],q(a,"hashName",_.string.dasherize(h).substring(1));n=this.views,p=[];for(h in n){d=n[h],e=[],o=d.prototype.defaults;for(f in o)r=o[f],_.isBoolean(r)&&e.push(f);q(d,"booleans",e),p.push(q(d,"elementName",_.string.dasherize(h).substring(1).replace("-view","")))}return p})}.call(this),function(){Hipbone.Application.prototype.initializers.push(function(){return $("body").on("click","a:not([bypass])",function(a){return function(b){var c;return b.ctrlKey||b.metaKey||Hipbone.history.location.hostname!==b.currentTarget.hostname||$(b.currentTarget).attr("target")||!(c=$(b.currentTarget).attr("href"))?void 0:(b.preventDefault(),a.router.navigate(c,{trigger:!0}))}}(this))})}.call(this),function(){Hipbone.Application.prototype.initializers.push(function(){return this.on("run",function(){var a,b,c,d;Handlebars.parseHTML(document.body.childNodes),b=this.identityMap.match(/view/),c=[];for(a in b)d=b[a],d instanceof this.views.ApplicationView&&c.push(this.appView=d);return c})})}.call(this),function(){Hipbone.Application.prototype.initializers.push(function(){var a;return a=Handlebars.parseValue,Handlebars.parseValue=function(b){return function(c,d){var e;return c=a.apply(b,[c,d]),c&&(e=b.identityMap.find(c.cid))&&(c=e),c}}(this)})}.call(this),function(){Hipbone.Application.prototype.initializers.push(function(){return $("body").on("submit","form:not([bypass])",function(a){return a.preventDefault()})})}.call(this),function(){Hipbone.Application.prototype.initializers.push(function(){var a,b,c,d;c=this.views,d=[];for(b in c)a=c[b],d.push(function(a,b){return Handlebars.registerElement(b.prototype.elementName,function(a){return new b(a,$(this).contents()).el},{booleans:b.prototype.booleans})}(b,a));return d})}.call(this),function(){var slice=[].slice;Hipbone.Application.prototype.initializers.push(function(){var eachHelper,ifHelper;return Handlebars.registerHelper("asset",function(a,b){return null==b&&(b={}),Hipbone.app.assets[a]}),Handlebars.registerHelper("t",function(a,b){return null==b&&(b={}),Hipbone.app.i18n.t(a,b.hash)}),Handlebars.registerHelper("url",function(a,b){return null==b&&(b={}),Hipbone.app.router.buildUrl(a,b.hash)}),Handlebars.registerHelper("fmt",function(){var a,b,c,d,e;return e=arguments[0],a=3<=arguments.length?slice.call(arguments,1,b=arguments.length-1):(b=1,[]),d=arguments[b++],null==d&&(d={}),c=0,e.replace(/%@/g,function(b){return a[c++]})}),Handlebars.registerHelper("eval",function(javascript,options){return null==options&&(options={}),eval(javascript)}),Handlebars.registerHelper("template",function(a,b){var c,d;return null==b&&(b={}),a=Hipbone.app.templatePath+a,c=_.isEmpty(b.hash)?this:b.hash,d=Hipbone.app.templates[a](c),b.hash.unescape?d:new Handlebars.SafeString(d)}),eachHelper=Handlebars.helpers.each,Handlebars.registerHelper("each",function(a,b){return null==b&&(b={}),a&&(a=a.models||a),eachHelper.apply(this,[a,b])}),ifHelper=Handlebars.helpers["if"],Handlebars.registerHelper("if",function(a,b){var c;return null==b&&(b={}),b.hash.bind&&(null!=(c=_.path(this,a))?c.models:void 0)?a+=".models":a&&(a=a.models||a),ifHelper.apply(this,[a,b])})})}.call(this),function(){Hipbone.Application.prototype.initializers.push(function(){return this.on("run",function(){return this.trigger("start",Hipbone.history.start({pushState:!0}))})})}.call(this),function(){var a=function(a,c){function d(){this.constructor=a}for(var e in c)b.call(c,e)&&(a[e]=c[e]);return d.prototype=c.prototype,a.prototype=new d,a.__super__=c.prototype,a},b={}.hasOwnProperty;Hipbone.Route=function(b){function c(a){var b,c,d;return null==a&&(a={}),a=_.defaults({},this.parse(a),this.defaults),b=this.hashes(a),c=Hipbone.history.location.pathname,Hipbone.app.identityMap.find(c)&&!Hipbone.history.popstate&&(b=_.without(b,c)),(d=Hipbone.app.identityMap.findAll(b)[0])?(d.set(a),d.display(),d):(this.store(b),this.cid=_.uniqueId("route"),this.initializeAccessor({accessorsName:"params",accessors:a}),this.initialize(a),void this.populate())}return a(c,b),c.include(Hipbone.Accessor),c.include(Backbone.Events),c.prototype.hashName="route",c.prototype.initialize=function(){},c.prototype.setAccessor=function(){return Hipbone.Accessor.setAccessor.apply(this,arguments),this.store()},c.prototype.fetch=function(){},c.prototype.context=function(){},c.prototype.transition=function(){},c.prototype.populate=function(){return this.prepare().done(function(a){return function(){return a.display()}}(this))},c.prototype.display=function(){return this.transition()!==!1?(document.title=this.title(),this.render()):void 0},c.prototype.prepare=function(){return $.when(this.fetch())},c.prototype.parse=function(a){return null==a&&(a={}),a},c.prototype.hashes=function(a){var b;return null==a&&(a={}),b=[],this.cid&&b.push(this.cid),b.push(Hipbone.history.location.pathname),b},c.prototype.buildUrl=function(a){null==a&&(a={})},c.prototype.title=function(){return Hipbone.app.title},c.prototype.content=function(){return Hipbone.app.appView.template(this.contentName,this.context())},c.prototype.render=function(){return this.element||(this.element=this.content()),Hipbone.app.appView.templateName=this.templateName,Hipbone.app.appView.set(this.context()),Hipbone.app.appView.content!==this.element?(Hipbone.app.appView.setContent(null),Hipbone.app.appView.$el.children().detach(),Hipbone.app.appView.render(),Hipbone.app.appView.setContent(this.element)):void 0},c.prototype.store=function(a){return a||(a=this.hashes(this.params)),Hipbone.app.identityMap.storeAll(a,this)},c}(Hipbone.Module)}.call(this),function(){var a=function(a,c){function d(){this.constructor=a}for(var e in c)b.call(c,e)&&(a[e]=c[e]);return d.prototype=c.prototype,a.prototype=new d,a.__super__=c.prototype,a},b={}.hasOwnProperty;Hipbone.Router=function(b){function c(a){null==a&&(a={}),this.matches={},c.__super__.constructor.apply(this,arguments)}return a(c,b),c.prototype.buildUrl=function(a,b){return Hipbone.app.routes[this.matches[a]].prototype.buildUrl(b)},c.prototype.matchUrl=function(a){return Hipbone.app.routes[this.matches[a]].prototype.matchUrl},c.prototype.match=function(a){var b;return this.matches[a]=_.string.capitalize(a)+"Route",b=this.matchUrl(a),this.route(b,a,function(){var c,d,e,f,g;for(this.params=Hipbone.history.parameters(),g=b.match(/:\w+/g)||[],d=c=0,e=g.length;e>c;d=++c)f=g[d],arguments[d]&&(this.params[f.substring(1)]=_.parse(arguments[d]));return this.route=new Hipbone.app.routes[this.matches[a]](this.params)})},c.prototype.navigate=function(a,b){var d;return null==b&&(b={}),this.matches[a]&&(a=this.buildUrl(a,b)),d=$("<a>").attr("href",a).get(0),b.params&&(d.search=$.param(b.params)),a=d.pathname+d.search,b.reload?Hipbone.history.reload(a):b.load?Hipbone.history.loadUrl(a):c.__super__.navigate.call(this,a,b)},c}(Backbone.Router)}.call(this),function(){var a=function(a,c){function d(){this.constructor=a}for(var e in c)b.call(c,e)&&(a[e]=c[e]);return d.prototype=c.prototype,a.prototype=new d,a.__super__=c.prototype,a},b={}.hasOwnProperty;Hipbone.Storage=function(b){function c(){return c.__super__.constructor.apply(this,arguments)}return a(c,b),c.prototype.match=function(a){var b,c,d;c={};for(b in localStorage)d=localStorage[b],a.test(b)&&(c[b]=JSON.parse(d));return c},c.prototype.get=function(a){var b;return(b=localStorage[a])?_.parse(b):void 0},c.prototype.set=function(a,b){return localStorage.setItem(a,JSON.stringify(b))},c.prototype.unset=function(a){return localStorage.removeItem(a)},c}(Hipbone.Module)}.call(this),function(){var a;a=Backbone.sync,Hipbone.sync=Backbone.sync=function(b,c,d){return null==d&&(d={}),d.sync=!0,d.url||(d.url=c.url()),d=Hipbone.app.ajaxSettings(d),Hipbone.app.ajaxHandle(a.apply(this,[b,c,d]))}}.call(this),function(){var a=function(a,c){function d(){this.constructor=a}for(var e in c)b.call(c,e)&&(a[e]=c[e]);return d.prototype=c.prototype,a.prototype=new d,a.__super__=c.prototype,a},b={}.hasOwnProperty,c=[].slice;Hipbone.View=function(b){function d(a,b){var c,e;return null==a&&(a={}),c=this.hashes(a),(e=Hipbone.app.identityMap.findAll(c)[0])?(e.setContent(b),e.set(a),e):(this.store(c),this.booleans||(this.booleans=[]),this.elements||(this.elements={}),this.internal={},this.content=b,this.classNameBindings||(this.classNameBindings={}),this.deferact=_.debounce(this.react),this.initializeAccessor({accessorsName:"properties",accessors:a}),d.__super__.constructor.apply(this,arguments),this.populate(),this.render(),void this.hooks())}return a(d,b),d.include(Hipbone.Accessor),d.prototype.hashName="view",d.prototype.elementName="view",d.prototype.destroy=function(){},d.prototype.insert=function(){},d.prototype.detach=function(){},d.prototype.change=function(a,b){},d.prototype.hooks=function(){return this.$el.lifecycle({insert:function(a){return function(){return a.insert(),a.trigger("insert")}}(this),remove:function(a){return function(){return a.detach(),a.trigger("detach")}}(this),change:function(a){return function(b,c){return a.change(b,c),b=_.string.camelize(b),a.set(b,Handlebars.parseValue(c,_.contains(a.booleans,b)))}}(this)})},d.prototype.setAccessor=function(a,b,c){var d;return null==c&&(c={}),_.isObject(a)&&(c=b||{}),Hipbone.Accessor.setAccessor.apply(this,arguments),(null!=(d=this.$el)?d.is("[lifecycle]"):void 0)&&this.update(c),this.store()},d.prototype._ensureElement=function(){return d.__super__._ensureElement.apply(this,arguments),this.set({"class":this.el.className+" "+(this.get("class")||"")}),this._setAttributes(this.properties),this.el.hipboneView=this},d.prototype.setContent=function(a){return this.container?this.$(this.container).append(a):this.$el.append(a),this.content=a},d.prototype.setAttribute=function(a,b){if(a=_.string.dasherize(a),"class"===a)return this.$el.addClass(b);if(_.contains(this.booleans,a)){if(b)return this.$el.attr(a,"")}else if(!_.isObject(b))return this.$el.attr(a,b)},d.prototype._setAttributes=function(a){var b,c,d;null==a&&(a={}),c=[];for(b in a)d=a[b],c.push(this.setAttribute(b,d));return c},d.prototype.$=function(a){return d.__super__.$.call(this,this.elements[a]||a)},d.prototype.$view=function(a){return this.$(a)[0]?this.$(a)[0].hipboneView:void 0},d.prototype.fetch=function(){},d.prototype.synced=function(){},d.prototype.populate=function(){return this.synced()||this.set({loading:!0}),this.prepare().done(function(a){return function(){return a.set({loading:!1})}}(this))},d.prototype.prepare=function(){return this.background?this.fetch():$.when(this.synced()||this.fetch())},d.prototype.context=function(){},d.prototype.update=function(a){return null==a&&(a={}),this.merge(this.present(this.context())),a.immediate||Object.observe?this.react():this.deferact()},d.prototype.render=function(){return this.merge(this.present(this.context())),this.templateName&&this.$el.html(this.template(this.templateName)),this.content?this.setContent(this.content):void 0},d.prototype.template=function(a,b){return a=Hipbone.app.templatePath+a,b=_.isEmpty(b)?this.internal:this.present(b),$(Handlebars.parseHTML(Hipbone.app.templates[a](b)))},d.prototype.context=function(){},d.prototype.present=function(a){var b,c,d;null==a&&(a={}),c=a=_.defaults(a,this.properties);for(b in c)d=c[b],(d instanceof Hipbone.Model||d instanceof Hipbone.Collection)&&(a[b]=d.toJSON());return a},d.prototype.delegate=function(a,b,c){return b=this.elements[b]||b,d.__super__.delegate.call(this,a,b,c)},d.prototype.bubble=function(){var a,b;return b=arguments[0],a=2<=arguments.length?c.call(arguments,1):[],this.trigger.apply(this,arguments),this.$el.trigger(b,a)},d.prototype.remove=function(){return this.destroy(),d.__super__.remove.apply(this,arguments)},d.prototype.hashes=function(a){var b;return null==a&&(a={}),b=[],this.cid&&b.push(this.cid),b},d.prototype.react=function(){var a,b,c,d,e;this._classNameBindings||(this._classNameBindings={}),d=this.classNameBindings;for(b in d)a=d[b],c=this._classNameBindings[b],e=this._classNameBindings[b]=a.apply(this),_.isBoolean(e)?e?this.$el.addClass(b):this.$el.removeClass(b):e!==c&&(this.$el.removeClass(c),this.$el.addClass(e));return Platform.performMicrotaskCheckpoint()},d.prototype.merge=function(a){return jsondiffpatch.config.objectHash=function(a){return(null!=a?a.cid:void 0)||a},jsondiffpatch.patch(this.internal,jsondiffpatch.diff(this.internal,a))},d.prototype.store=function(a){return a||(a=this.hashes()),Hipbone.app.identityMap.storeAll(a,this)},d}(Backbone.View)}.call(this);